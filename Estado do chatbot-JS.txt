// Estado do chatbot
let chatState = 'initial';
let awaitingCustomPlatform = false;

// Fun√ß√£o principal de envio de mensagens
function sendChatMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (message === '') return;
  
  const messagesDiv = document.getElementById('chatbotMessages');
  
  // Adiciona mensagem do usu√°rio
  const userMessage = document.createElement('div');
  userMessage.className = 'chat-message user';
  userMessage.innerHTML = `<div class="message-bubble">${message}</div>`;
  messagesDiv.appendChild(userMessage);
  
  input.value = '';
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  
  // Se est√° esperando resposta de plataforma customizada
  if (awaitingCustomPlatform) {
    setTimeout(() => {
      const botMessage = document.createElement('div');
      botMessage.className = 'chat-message bot';
      botMessage.innerHTML = `<div class="message-bubble">Obrigado! Registramos sua plataforma: <strong>${message}</strong>. Nossa equipe de suporte entrar√° em contato para auxiliar na integra√ß√£o. üòä<br><br>Precisa de mais alguma ajuda?</div>`;
      messagesDiv.appendChild(botMessage);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      awaitingCustomPlatform = false;
      chatState = 'initial';
    }, 800);
    return;
  }
  
  // Resposta padr√£o
  setTimeout(() => {
    const botMessage = document.createElement('div');
    botMessage.className = 'chat-message bot';
    let response = showInitialMessage();
    botMessage.innerHTML = `<div class="message-bubble">${response}</div>`;
    messagesDiv.appendChild(botMessage);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }, 800);
}

// Mensagem inicial do chatbot
function showInitialMessage() {
  chatState = 'initial';
  return `Verifiquei que sua conta ainda n√£o foi configurada na plataforma. O nosso time de onboarding realizar√° o primeiro contato at√© 16h √∫teis ap√≥s a compra. J√° deu uma olhadinha no seu e-mail? üòâ<br><br>Caso deseje falar sobre outro assunto, <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">clique aqui</a>.`;
}

// Menu principal com todas as 9 op√ß√µes
function showMainMenu() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble">
    Escolha uma das op√ß√µes abaixo:<br><br>
    <a href="#" onclick="event.preventDefault(); showPainelVendas();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">1 - Falar sobre o painel de vendas</a>
    <a href="#" onclick="event.preventDefault(); showIntegracoes();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">2 - Falar sobre a integra√ß√£o com a plataforma de vendas</a>
    <a href="#" onclick="event.preventDefault(); showEmissoesCancelamentos();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">3 - Falar sobre minhas emiss√µes/cancelamentos negados</a>
    <a href="#" onclick="event.preventDefault(); showExtrairRelatorios();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">4 - Extrair o relat√≥rio PDF e XML</a>
    <a href="#" onclick="event.preventDefault(); showAlterarDados();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">5 - Como alterar os meus dados fiscais ou certificado digital?</a>
    <a href="#" onclick="event.preventDefault(); showConfigurarEndereco();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">6 - Configurar endere√ßo padr√£o para emiss√£o das notas fiscais</a>
    <a href="#" onclick="event.preventDefault(); showAlteracaoMunicipio();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">7 - Realizei altera√ß√£o de munic√≠pio</a>
    <a href="#" onclick="event.preventDefault(); showConfigurarNovoTipo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">8 - Preciso realizar configura√ß√£o de novo tipo de NF</a>
    <a href="#" onclick="event.preventDefault(); showEmissaoAvulsa();" style="color: #1a73e8; text-decoration: underline; cursor: pointer; display: block; margin: 8px 0;">9 - Consigo realizar uma emiss√£o avulsa?</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 1: Painel de Vendas
function showPainelVendas() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble">
    <strong>Painel de Vendas</strong><br><br>
    Escolha uma op√ß√£o:<br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showFiltrosResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Precisa de ajuda com aplica√ß√£o de filtros?</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showAcoesEmMassaResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Realizar a√ß√µes em massa</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showCancelarNotaResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Cancelar uma nota fiscal</a><br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Filtros do Painel
function showFiltrosResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #1abc9c; padding-left: 12px;">
    <strong>Como usar os filtros do painel de vendas</strong><br><br>
    Os filtros permitem encontrar vendas espec√≠ficas rapidamente. Voc√™ pode filtrar por:<br><br>
    ‚Ä¢ Data de emiss√£o<br>
    ‚Ä¢ Nome do cliente<br>
    ‚Ä¢ Produto vendido<br>
    ‚Ä¢ Canal de venda (Hotmart, Kiwify, etc)<br>
    ‚Ä¢ Status da nota fiscal<br><br>
    Basta preencher os campos desejados e clicar em "Aplicar". üìä<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773616019085" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Abrir artigo completo</a><br><br>
    <a href="#" onclick="event.preventDefault(); showPainelVendas();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: A√ß√µes em Massa
function showAcoesEmMassaResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #1abc9c; padding-left: 12px;">
    <strong>Realizar a√ß√µes em massa</strong><br><br>
    Com as a√ß√µes em massa, voc√™ pode processar v√°rias vendas de uma s√≥ vez:<br><br>
    1. Selecione as vendas usando os checkboxes<br>
    2. Clique em "A√ß√µes em massa"<br>
    3. Escolha a a√ß√£o: gerar notas, cancelar, enviar por e-mail, etc<br><br>
    Isso economiza muito tempo! ‚ö°<br><br>
    <a href="#" onclick="event.preventDefault(); showPainelVendas();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Cancelar Nota Fiscal
function showCancelarNotaResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #1abc9c; padding-left: 12px;">
    <strong>Como cancelar uma nota fiscal</strong><br><br>
    Para cancelar uma venda/nota fiscal:<br><br>
    1. Localize a venda no painel<br>
    2. Clique nos tr√™s pontinhos (‚ãÆ) ou bot√£o de a√ß√µes<br>
    3. Selecione "Cancelar"<br>
    4. Informe o motivo do cancelamento<br>
    5. Confirme a opera√ß√£o<br><br>
    ‚ö†Ô∏è Aten√ß√£o: O cancelamento √© irrevers√≠vel!<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773357667213" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Abrir artigo completo</a><br><br>
    <a href="#" onclick="event.preventDefault(); showPainelVendas();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 2: Integra√ß√µes com Plataformas
function showIntegracoes() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble">
    <strong>Integra√ß√£o com Plataforma de Vendas</strong><br><br>
    Escolha sua plataforma:<br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showHotmartResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Hotmart</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showKiwifyResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Kiwify</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showEduzzResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Eduzz</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showOutraPlataforma();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Outra plataforma</a><br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Hotmart
function showHotmartResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #ff6b35; padding-left: 12px;">
    <strong>Integra√ß√£o com Hotmart üî•</strong><br><br>
    A integra√ß√£o permite emitir notas fiscais automaticamente para vendas da Hotmart.<br><br>
    <strong>Voc√™ vai precisar:</strong><br>
    ‚Ä¢ E-mail cadastrado na Hotmart<br>
    ‚Ä¢ Token Hottok (Hot Connect)<br><br>
    <strong>Passos principais:</strong><br>
    1. Acesse Ferramentas na Hotmart<br>
    2. Copie o Webhook URL<br>
    3. Gere e copie o Hottok<br>
    4. Cole os dados no eNotas<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773432368909" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Ver passo a passo completo</a><br><br>
    <a href="#" onclick="event.preventDefault(); showIntegracoes();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Kiwify
function showKiwifyResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #00d4aa; padding-left: 12px;">
    <strong>Integra√ß√£o com Kiwify ü•ù</strong><br><br>
    Conecte sua conta Kiwify ao eNotas para emiss√£o autom√°tica de notas fiscais.<br><br>
    <strong>O que voc√™ precisa:</strong><br>
    ‚Ä¢ Conta ativa na Kiwify<br>
    ‚Ä¢ Token de API da Kiwify<br><br>
    <strong>Resumo dos passos:</strong><br>
    1. Acesse Configura√ß√µes na Kiwify<br>
    2. V√° em Integra√ß√µes > API<br>
    3. Gere seu token de acesso<br>
    4. Configure no eNotas<br><br>
    Pronto! As notas ser√£o emitidas automaticamente. ‚úÖ<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773471206797" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Ver tutorial completo</a><br><br>
    <a href="#" onclick="event.preventDefault(); showIntegracoes();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Eduzz
function showEduzzResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #7b3fc5; padding-left: 12px;">
    <strong>Integra√ß√£o com Eduzz üöÄ</strong><br><br>
    Entenda como funciona a coprodu√ß√£o entre eNotas e Eduzz.<br><br>
    <strong>Importante saber:</strong><br>
    ‚Ä¢ A integra√ß√£o √© autom√°tica para coprodu√ß√µes<br>
    ‚Ä¢ Notas s√£o emitidas para o produtor principal<br>
    ‚Ä¢ Coprodutores recebem suas comiss√µes j√° com NF<br><br>
    <strong>Configura√ß√£o:</strong><br>
    1. Ative a integra√ß√£o no painel Eduzz<br>
    2. Configure seus produtos no eNotas<br>
    3. Defina as regras de comiss√£o<br><br>
    Tudo integrado e automatizado! üéØ<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773437963789" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Entender coprodu√ß√£o Eduzz</a><br><br>
    <a href="#" onclick="event.preventDefault(); showIntegracoes();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function showOutraPlataforma() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble">Por favor, digite o nome da sua plataforma de vendas:</div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  awaitingCustomPlatform = true;
}

// OP√á√ÉO 3: Emiss√µes/Cancelamentos Negados
function showEmissoesCancelamentos() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble">
    <strong>Emiss√µes/Cancelamentos Negados</strong><br><br>
    Escolha uma op√ß√£o:<br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showReprocessamentoResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Reprocessamento de notas com erro na emiss√£o</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showCancelamentoNegadoResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Cancelamento negado</a><br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Reprocessamento
function showReprocessamentoResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #e74c3c; padding-left: 12px;">
    <strong>Reprocessar notas com erro ‚ö†Ô∏è</strong><br><br>
    Quando uma nota apresenta erro na emiss√£o, voc√™ pode reprocess√°-la ap√≥s corrigir o problema.<br><br>
    <strong>Como fazer:</strong><br>
    1. Identifique a nota com erro no painel<br>
    2. Verifique qual foi o erro apresentado<br>
    3. Corrija os dados necess√°rios<br>
    4. Clique em "Reprocessar" ou "Tentar novamente"<br><br>
    <strong>Erros comuns:</strong><br>
    ‚Ä¢ Dados cadastrais incompletos<br>
    ‚Ä¢ Certificado digital vencido<br>
    ‚Ä¢ C√≥digo de servi√ßo incorreto<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773529645325" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Ver guia completo de reprocessamento</a><br><br>
    <a href="#" onclick="event.preventDefault(); showEmissoesCancelamentos();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Cancelamento Negado
function showCancelamentoNegadoResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #e74c3c; padding-left: 12px;">
    <strong>Cancelamento Negado üö´</strong><br><br>
    Algumas notas n√£o podem ser canceladas automaticamente pela prefeitura.<br><br>
    <strong>Como filtrar cancelamentos negados:</strong><br>
    1. Acesse o painel de vendas<br>
    2. Use o filtro de Status<br>
    3. Selecione "Cancelamento Negado"<br>
    4. Visualize a lista de notas<br><br>
    <strong>O que fazer:</strong><br>
    ‚Ä¢ Verifique o motivo da negativa<br>
    ‚Ä¢ Entre em contato com a prefeitura se necess√°rio<br>
    ‚Ä¢ Solicite suporte ao eNotas para casos complexos<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773410509197" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Saiba mais sobre cancelamentos negados</a><br><br>
    <a href="#" onclick="event.preventDefault(); showEmissoesCancelamentos();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 4: Extrair Relat√≥rios
function showExtrairRelatorios() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble">
    <strong>Extrair Relat√≥rios PDF e XML</strong><br><br>
    Escolha uma op√ß√£o:<br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showRelatorioPeriodoResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Extrair relat√≥rios de um per√≠odo espec√≠fico</a><br><br>
    ‚Ä¢ <a href="#" onclick="event.preventDefault(); showRelatorioNotaResumo();" style="color: #1a73e8; text-decoration: underline; cursor: pointer;">Apenas de uma nota fiscal</a><br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Relat√≥rio de Per√≠odo
function showRelatorioPeriodoResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #3498db; padding-left: 12px;">
    <strong>Extrair relat√≥rios de per√≠odo üìä</strong><br><br>
    Baixe PDFs, XMLs ou CSVs de todas as notas fiscais de um per√≠odo espec√≠fico.<br><br>
    <strong>Como fazer (Vis√£o do Contador):</strong><br>
    1. Acesse Menu Empresa<br>
    2. Clique em "Relat√≥rios" ou "Exportar"<br>
    3. Selecione o per√≠odo desejado<br>
    4. Escolha o formato (PDF, XML ou CSV)<br>
    5. Clique em "Baixar" ou "Exportar"<br><br>
    <strong>Formatos dispon√≠veis:</strong><br>
    ‚Ä¢ PDF - Para impress√£o e visualiza√ß√£o<br>
    ‚Ä¢ XML - Para importar em sistemas cont√°beis<br>
    ‚Ä¢ CSV - Para an√°lises em planilhas<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773346958221" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Tutorial completo de exporta√ß√£o</a><br><br>
    <a href="#" onclick="event.preventDefault(); showExtrairRelatorios();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Resumo: Relat√≥rio de Nota Espec√≠fica
function showRelatorioNotaResumo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #3498db; padding-left: 12px;">
    <strong>Acessar PDF de nota espec√≠fica üìÑ</strong><br><br>
    Baixe ou visualize o PDF de uma √∫nica nota fiscal.<br><br>
    <strong>Passo a passo:</strong><br>
    1. Localize a nota no painel de vendas<br>
    2. Clique no √≠cone de "Visualizar" ou "‚ãÆ"<br>
    3. Selecione "Ver PDF" ou "Baixar PDF"<br>
    4. O arquivo ser√° aberto/baixado<br><br>
    <strong>Dica r√°pida:</strong><br>
    Voc√™ tamb√©m pode clicar direto no n√∫mero da nota para visualiz√°-la! üöÄ<br><br>
    <strong>Precisa do XML?</strong><br>
    Use a mesma op√ß√£o e escolha "Baixar XML"<br><br>
    <a href="https://atendimento.enotas.com.br/hc/pt-br/articles/35773301267213" target="_blank" rel="noopener" style="color: #1a73e8; text-decoration: underline;">üìÑ Ver tutorial com imagens</a><br><br>
    <a href="#" onclick="event.preventDefault(); showExtrairRelatorios();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 5: Alterar Dados Fiscais
function showAlterarDados() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #f39c12; padding-left: 12px;">
    <strong>Alterar dados fiscais ou certificado digital üîê</strong><br><br>
    Para altera√ß√µes em dados fiscais ou certificado digital, nossa equipe de suporte precisar√° auxili√°-lo devido √† sensibilidade dessas informa√ß√µes.<br><br>
    <strong>O que pode ser alterado:</strong><br>
    ‚Ä¢ Raz√£o social<br>
    ‚Ä¢ CNPJ/CPF<br>
    ‚Ä¢ Endere√ßo fiscal<br>
    ‚Ä¢ Certificado digital (renova√ß√£o/atualiza√ß√£o)<br>
    ‚Ä¢ Regime tribut√°rio<br><br>
    <strong>Entre em contato:</strong><br>
    üìß E-mail: <strong>suporte@enotas.com.br</strong><br>
    üí¨ Chat no painel (hor√°rio comercial)<br><br>
    ‚ö†Ô∏è <strong>Importante:</strong> Tenha em m√£os os documentos atualizados!<br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 6: Configurar Endere√ßo Padr√£o
function showConfigurarEndereco() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #9b59b6; padding-left: 12px;">
    <strong>Configurar endere√ßo padr√£o üìç</strong><br><br>
    O endere√ßo padr√£o √© usado automaticamente na emiss√£o de todas as suas notas fiscais.<br><br>
    <strong>Como configurar:</strong><br>
    1. Acesse o <strong>Menu Empresa</strong><br>
    2. Clique em <strong>Configura√ß√µes</strong><br>
    3. V√° em <strong>Endere√ßo Padr√£o</strong><br>
    4. Preencha os campos:<br>
       ‚Ä¢ CEP<br>
       ‚Ä¢ Logradouro<br>
       ‚Ä¢ N√∫mero<br>
       ‚Ä¢ Complemento (se houver)<br>
       ‚Ä¢ Bairro<br>
       ‚Ä¢ Cidade e Estado<br>
    5. Clique em <strong>Salvar</strong><br><br>
    ‚úÖ Pronto! Todas as novas notas usar√£o este endere√ßo.<br><br>
    Precisa de mais ajuda? Entre em contato com nosso suporte.<br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 7: Altera√ß√£o de Munic√≠pio
function showAlteracaoMunicipio() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #e67e22; padding-left: 12px;">
    <strong>Altera√ß√£o de munic√≠pio üè¢‚û°Ô∏èüè¢</strong><br><br>
    Mudou sua empresa de cidade? Este processo requer aten√ß√£o especial!<br><br>
    <strong>O que precisa ser atualizado:</strong><br>
    ‚Ä¢ Inscri√ß√£o municipal (nova cidade)<br>
    ‚Ä¢ Certificado digital (mesmo CNPJ, novo munic√≠pio)<br>
    ‚Ä¢ Endere√ßo fiscal completo<br>
    ‚Ä¢ Configura√ß√µes de impostos (podem variar)<br><br>
    <strong>Documentos necess√°rios:</strong><br>
    ‚Ä¢ Alvar√° da nova cidade<br>
    ‚Ä¢ Nova inscri√ß√£o municipal<br>
    ‚Ä¢ Certificado digital atualizado<br>
    ‚Ä¢ Comprovante de endere√ßo<br><br>
    <strong>Como proceder:</strong><br>
    üìß Entre em contato: <strong>suporte@enotas.com.br</strong><br>
    Nossa equipe far√° todo o processo de migra√ß√£o com voc√™! ü§ù<br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 8: Configurar Novo Tipo de NF
function showConfigurarNovoTipo() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #16a085; padding-left: 12px;">
    <strong>Configurar novo tipo de NF üìã</strong><br><br>
    Precisa emitir um tipo diferente de nota fiscal? Podemos ajudar!<br><br>
    <strong>Tipos de nota dispon√≠veis:</strong><br>
    ‚Ä¢ NFS-e (Servi√ßos)<br>
    ‚Ä¢ NF-e (Produtos)<br>
    ‚Ä¢ NFC-e (Consumidor)<br>
    ‚Ä¢ CT-e (Transporte)<br><br>
    <strong>Cada munic√≠pio tem suas regras!</strong><br>
    As configura√ß√µes variam conforme:<br>
    ‚Ä¢ Legisla√ß√£o local<br>
    ‚Ä¢ Sistema da prefeitura<br>
    ‚Ä¢ Atividade da empresa<br>
    ‚Ä¢ Regime tribut√°rio<br><br>
    <strong>Solicite configura√ß√£o:</strong><br>
    üìß E-mail: <strong>suporte@enotas.com.br</strong><br>
    Informe qual tipo de NF voc√™ precisa configurar!<br><br>
    Nossa equipe t√©cnica far√° toda a configura√ß√£o para voc√™. üë®‚Äçüíª<br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// OP√á√ÉO 9: Emiss√£o Avulsa
function showEmissaoAvulsa() {
  const messagesDiv = document.getElementById('chatbotMessages');
  const botMessage = document.createElement('div');
  botMessage.className = 'chat-message bot';
  botMessage.innerHTML = `<div class="message-bubble" style="border-left: 3px solid #27ae60; padding-left: 12px;">
    <strong>Emiss√£o avulsa de nota fiscal ‚úçÔ∏è</strong><br><br>
    Sim! Voc√™ pode emitir notas fiscais manualmente atrav√©s do menu:<br>
    <strong>Vendas ‚Üí Nova Venda Manual</strong><br><br>
    <strong>Passo a passo:</strong><br>
    1. Clique em <strong>"Nova Venda Manual"</strong><br>
    2. Preencha os dados do <strong>cliente</strong>:<br>
       ‚Ä¢ Nome/Raz√£o Social<br>
       ‚Ä¢ CPF/CNPJ<br>
       ‚Ä¢ E-mail<br>
       ‚Ä¢ Endere√ßo<br>
    3. Adicione o <strong>produto/servi√ßo</strong>:<br>
       ‚Ä¢ Descri√ß√£o<br>
       ‚Ä¢ C√≥digo de servi√ßo<br>
       ‚Ä¢ Valor<br>
    4. Revise os dados<br>
    5. Clique em <strong>"Emitir Nota Fiscal"</strong><br><br>
    ‚úÖ Pronto! A nota ser√° emitida na hora e enviada por e-mail automaticamente. üòä<br><br>
    <strong>Dica:</strong> Salve clientes frequentes para facilitar emiss√µes futuras!<br><br>
    <a href="#" onclick="event.preventDefault(); showMainMenu();" style="color: #7b3fc5; text-decoration: underline; cursor: pointer; font-size: 12px;">‚Üê Voltar ao menu</a>
  </div>`;
  messagesDiv.appendChild(botMessage);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Fun√ß√µes auxiliares
function toggleChatbot() {
  const chatWindow = document.getElementById('chatbotWindow');
  chatWindow.classList.toggle('open');
  if (chatWindow.classList.contains('open')) {
    document.getElementById('chatInput').focus();
  }
}

function handleChatKeyPress(event) {
  if (event.key === 'Enter') {
    sendChatMessage();
  }
}